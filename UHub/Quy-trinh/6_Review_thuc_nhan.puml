@startuml Review_thuc_nhan
title Quy tr√¨nh Review th·ª±c nh·∫≠n & Show danh s√°ch Store ph√¢n b·ªï
skinparam backgroundColor #FEFEFE
skinparam activity {
  BackgroundColor #E6F3FF
  BorderColor #0066CC
  DiamondBackgroundColor #FFF0E6
  DiamondBorderColor #FF6600
}

|#LightBlue|Store Manager|
|#LightGreen|Regional Manager|
|#LightYellow|UHub System|
|#Pink|Agency|
|#Orange|Audit Team|

|Store Manager|
start
:Receive delivery notification;
:Physical receipt of gifts;
:Count actual quantity;
note right
  **Verification steps:**
  ‚Ä¢ Open packages
  ‚Ä¢ Count by type
  ‚Ä¢ Check condition
  ‚Ä¢ Verify serial numbers
end note

:Input actual received;

|UHub System|
:Display allocation list;
note left
  **Show information:**
  ‚Ä¢ Store name & code
  ‚Ä¢ Allocated quantity
  ‚Ä¢ Expected delivery date
  ‚Ä¢ Gift types/schemes
  ‚Ä¢ Campaign details
end note

:Compare allocated vs actual;
:Calculate variance;
if (Variance = 0?) then (yes)
  :Mark as matched;
  :Auto-confirm receipt;
else (no)
  if (Shortage?) then (yes)
    :Flag shortage;
    :Create discrepancy report;
  else (Excess)
    :Flag excess;
    :Create surplus report;
  endif
endif

:Generate receipt report;
:Update store inventory;

|Store Manager|
:Review system report;
:Attach evidence;
note right
  Evidence:
  ‚Ä¢ Photos of goods
  ‚Ä¢ Delivery notes
  ‚Ä¢ Count sheets
  ‚Ä¢ Damage photos (if any)
end note

if (Discrepancy exists?) then (yes)
  :Document reasons;
  :Submit for review;
  
  |Regional Manager|
  :Review discrepancy;
  :Verify evidence;
  if (Valid discrepancy?) then (yes)
    :Approve adjustment;
    :Escalate if needed;
  else (no)
    :Request recount;
    |Store Manager|
    :Perform recount;
    :Update figures;
    |Regional Manager|
  endif
else (no)
  :Confirm receipt;
endif

|UHub System|
partition "Dashboard Update" {
  :Update allocation dashboard;
  :Show store-wise status;
  :Calculate fulfillment rate;
  note left
    **Dashboard shows:**
    ‚Ä¢ Allocated vs Received
    ‚Ä¢ Pending deliveries
    ‚Ä¢ Discrepancy list
    ‚Ä¢ Store performance
    ‚Ä¢ Regional summary
  end note
}

:Generate analytics;
:Create distribution map;
if (All stores received?) then (yes)
  :Mark batch complete;
else (no)
  :Show pending stores;
  :Send reminders;
endif

|Agency|
:Receive discrepancy reports;
:Investigate issues;
if (Delivery issue?) then (yes)
  :Check with logistics;
  :Provide explanation;
else (no)
  :Verify pick-list;
  :Reconcile quantities;
endif

|Audit Team|
:Monthly review;
:Analyze patterns;
if (Systematic issues?) then (yes)
  :Create improvement plan;
  :Update SOPs;
else (no)
  :Document as normal;
endif

|Store Manager|
:Access final report;
:Acknowledge completion;
stop

legend right
  **Store Allocation View:**
  ‚Ä¢ Store details
  ‚Ä¢ Campaign mapping
  ‚Ä¢ Quantity allocated
  ‚Ä¢ Delivery schedule
  ‚Ä¢ Receipt status
  ‚Ä¢ Discrepancy flag
  
  **Status Types:**
  ‚Ä¢ ‚úÖ Matched: Received = Allocated
  ‚Ä¢ ‚ö†Ô∏è Shortage: Received < Allocated
  ‚Ä¢ ‚ö†Ô∏è Excess: Received > Allocated
  ‚Ä¢ üî¥ Not Received: Pending delivery
  ‚Ä¢ ‚úîÔ∏è Confirmed: Manager approved
  
  **Review Levels:**
  ‚Ä¢ Store: Initial verification
  ‚Ä¢ Regional: Discrepancy review
  ‚Ä¢ Audit: Pattern analysis
endlegend

@enduml
